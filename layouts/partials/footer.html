{{ if .Site.Params.newsletter.enable }}
<section class="section-sm newsletter-section">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto text-center">
        <h2>{{ .Site.Params.newsletter.title | markdownify }}</h2>
        <p class="text-light px-md-5 py-4 border-left border-right border-primary">
          {{ .Site.Params.newsletter.content | markdownify }}</p>
        <form action="{{ .Site.Params.newsletter.action }}" method="post"
          class="row justify-content-center newsletter-form" id="newsletter-form">
          <div class="input-group col-md-8">
            <input type="email" name="email" class="form-control" placeholder="您的電子郵件地址" required>
            <div class="input-group-append">
              <button type="submit" class="input-group-text btn btn-primary">訂閱</button>
            </div>
          </div>
          <div class="col-12 newsletter-response mt-2" id="newsletter-response"></div>
        </form>
      </div>
    </div>
  </div>
</section>
{{ end }}

<footer class="text-capitalize footer-section">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center mb-5">
        <a href="{{ .Site.BaseURL }}" aria-label="{{ .Site.Title }}">
          {{ if .Site.Params.logo }}
          <img loading="lazy" src="{{ .Site.Params.logo | absURL }}" alt="{{ .Site.Title }}" class="footer-logo">
          {{ else }}
          <h3>{{ .Site.Title }}</h3>
          {{ end }}
        </a>
      </div>
      {{ if or .Site.Params.mobile .Site.Params.location .Site.Params.email }}
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">聯絡我們</h6>
        <ul class="list-unstyled contact-list">
          {{ if .Site.Params.mobile }}
          <li class="mb-3">
            <a class="text-dark d-flex align-items-center" href="tel:{{ .Site.Params.mobile }}">
              <i class="ti-mobile text-primary"></i>{{ .Site.Params.mobile }}
            </a>
          </li>
          {{ end }}
          {{ if .Site.Params.location }}
          <li class="mb-3 d-flex align-items-center">
            <i class="ti-location-pin text-primary"></i>{{ .Site.Params.location }}
          </li>
          {{ end }}
          {{ if .Site.Params.email }}
          <li class="mb-3">
            <a class="text-dark d-flex align-items-center" href="mailto:{{ .Site.Params.email }}">
              <i class="ti-email text-primary"></i>{{ .Site.Params.email }}
            </a>
          </li>
          {{ end }}
        </ul>
      </div>
      {{ end }}
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">社群連結</h6>
        <ul class="list-unstyled social-list">
          {{ range .Site.Params.social }}
          <li class="mb-3">
            <a class="text-dark social-item" href="{{ .link | safeURL }}" {{ if .target }}target="{{ .target }}" {{ end
              }}>
              {{ if .icon }}<i class="{{ .icon }}"></i>{{ end }}{{ .title }}
            </a>
          </li>
          {{ end }}
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">文章分類</h6>
        <ul class="list-unstyled category-list">
          <li class="mb-3">
            <a class="text-dark category-item" href="{{ `categories/` | relLangURL }}">
              查看所有分類
            </a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">快速連結</h6>
        <ul class="list-unstyled quick-links">
          {{ range .Site.Menus.footer }}
          <li class="mb-3">
            <a class="text-dark" href="{{ .URL | absURL }}">
              {{ if .Pre }}<i class="{{ .Pre }} mr-2"></i>{{ end }}{{ .Name }}
            </a>
          </li>
          {{ end }}
        </ul>
      </div>
      <div class="col-12 border-top py-4 text-center footer-copyright">
        {{ .Site.Params.copyright | markdownify }}
      </div>
    </div>
  </div>
</footer>

<a href="#" id="return-to-top"><i class="fas fa-arrow-up"></i></a>
<a href="#" id="go-to-bottom"><i class="fas fa-arrow-down"></i></a>

<script>
  var indexURL = "{{ "index.json" | absURL | safeJS }}";
</script>

{{ "<!-- JS Plugins -->" | safeHTML }}
{{ range .Site.Params.plugins.js}}
<script src="{{ .URL | absURL }}" {{ if .async }}async{{ end }} {{ if .defer }}defer{{ end }}></script>
{{ end }}
{{ "<!-- Main Script -->" | safeHTML }}
{{ $script := resources.Get "js/script.js" | minify}}
<script src="{{ $script.Permalink }}"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const themeToggle = document.getElementById('checkbox');
    const body = document.body;
    const themeClass = 'dark-mode';

    function applyTheme(theme) {
      if (theme === 'dark') {
        body.classList.add(themeClass);
        if (themeToggle) themeToggle.checked = true;
        localStorage.setItem('theme', 'dark');
      } else {
        body.classList.remove(themeClass);
        if (themeToggle) themeToggle.checked = false;
        localStorage.setItem('theme', 'light');
      }
    }

    // Initial check
    const savedTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    if (savedTheme === 'dark' || savedTheme === 'dark-mode') {
      applyTheme('dark');
    } else if (!savedTheme && prefersDark) {
      applyTheme('dark');
    } else {
      applyTheme('light');
    }

    // Event listener
    if (themeToggle) {
      themeToggle.addEventListener('change', function (e) {
        if (e.target.checked) {
          applyTheme('dark');
        } else {
          applyTheme('light');
        }
      });
    }

    // === Code Block Copy Functionality ===
    const codeBlocks = document.querySelectorAll('pre');
    codeBlocks.forEach(function (pre) {
      // Create copy button
      const button = document.createElement('button');
      button.className = 'copy-button';
      button.innerText = 'Copy';

      // Position button (handled by CSS, but we append it to the pre)
      pre.appendChild(button);

      button.addEventListener('click', function () {
        // Find the code element inside
        const code = pre.querySelector('code');
        const textToCopy = code ? code.innerText : pre.innerText;

        // Copy using Clipboard API
        navigator.clipboard.writeText(textToCopy).then(function () {
          button.innerText = 'Copied!';
          setTimeout(function () {
            button.innerText = 'Copy';
          }, 2000);
        }).catch(function (err) {
          console.error('Failed to copy: ', err);
          button.innerText = 'Error';
        });
      });
    });
  });
</script>

<!-- Newsletter Script -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('newsletter-form');
    if (form) {
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        const response = document.getElementById('newsletter-response');
        const email = this.querySelector('input[name="email"]').value;

        // 這裡可以添加實際的表單提交邏輯
        // 例如使用fetch API提交到指定端點

        response.innerHTML = '<p class="text-success">感謝您的訂閱！</p>';
        this.reset();
      });
    }
  });
</script>

<!-- cookie -->
{{ if site.Params.cookies.enable }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
<div id="js-cookie-box" class="cookie-box cookie-box-hide">
  <div class="container">
    <div class="cookie-content">
      <p>本網站使用Cookie來改善您的瀏覽體驗。繼續使用本網站，即表示您同意我們的Cookie使用政策。</p>
      <div class="cookie-buttons">
        <button id="js-cookie-button" class="btn btn-sm btn-primary">我接受</button>
        <a href="{{ .Site.Params.cookies.policy_url }}" class="btn btn-sm btn-outline-secondary ml-2">了解更多</a>
      </div>
    </div>
  </div>
</div>
<script>
  (function () {
    const cookieBox = document.getElementById('js-cookie-box');
    const cookieButton = document.getElementById('js-cookie-button');

    function initCookieBox() {
      if (typeof Cookies === 'undefined') {
        setTimeout(initCookieBox, 1000);
        return;
      }

      if (cookieBox && !Cookies.get('cookie-box')) {
        cookieBox.classList.remove('cookie-box-hide');
        cookieButton.onclick = function () {
          Cookies.set('cookie-box', true, {
            expires: {{ site.Params.cookies.expire_days | default 1 }}
      });
      localStorage.setItem('cookie-consent', 'true');
      cookieBox.classList.add('cookie-box-hide');
    };
  }
    }
  initCookieBox();
  }) ();
</script>
{{ end }}